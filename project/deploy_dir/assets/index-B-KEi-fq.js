var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,s,o)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o,l=(e,t)=>{for(var s in t||(t={}))r.call(t,s)&&i(e,s,t[s]);if(o)for(var s of o(t))n.call(t,s)&&i(e,s,t[s]);return e},a=(e,o)=>t(e,s(o)),c=(e,t,s)=>i(e,"symbol"!=typeof t?t+"":t,s),d=(e,t,s)=>new Promise((o,r)=>{var n=e=>{try{l(s.next(e))}catch(t){r(t)}},i=e=>{try{l(s.throw(e))}catch(t){r(t)}},l=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,i);l((s=s.apply(e,t)).next())});import{r as u,u as h,j as m,C as x,S as b,B as g,a as f,b as p,V as v,R as y,c as k}from"./three-C2FTrFAv.js";import"./vendor-DEQ385Nk.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const j=new class{constructor(){c(this,"blocks",new Map),c(this,"items",new Map),c(this,"recipes",new Map),c(this,"biomes",new Map),c(this,"loaded",!1),c(this,"initialBlocksSet",!1),this.initializeBasicBlocks()}initializeBasicBlocks(){if(this.initialBlocksSet)return;["grass_block","dirt","stone","sand","water","wood_log","oak_log","oak_planks","cobblestone","coal_ore","iron_ore","diamond_ore","glass","leaves","oak_leaves"].forEach((e,t)=>{this.blocks.set(e,{id:e,name:e.replace("_"," "),hardness:1.5,bestTool:"pickaxe",transparent:"water"===e||"glass"===e,texture:`color:${e}`})}),this.initialBlocksSet=!0}loadGameData(){return d(this,null,function*(){if(!this.loaded)try{this.initialBlocksSet||this.initializeBasicBlocks();try{const e=yield fetch("/data/blocks/block_catalog.json"),t=yield e.json();Object.values(t.block_catalog.categories).forEach(e=>{Object.entries(e.blocks).forEach(([e,t])=>{this.blocks.set(e,a(l({},t),{id:e,texture:`color:${e}`}))})})}catch(e){}try{const e=yield fetch("/data/items/item_catalog.json"),t=yield e.json();Object.values(t.item_catalog.categories).forEach(e=>{Object.entries(e.items||e.sets||{}).forEach(([t,s])=>{var o,r;"object"==typeof s&&s.name&&this.items.set(t,l({id:t,name:s.name,type:(null==(o=e.description)?void 0:o.includes("инструмент"))?"tool":(null==(r=e.description)?void 0:r.includes("оружие"))?"weapon":"material",stackSize:s.durability?1:64,texture:`color:${t}`},s))})})}catch(t){["dirt","stone","wood_log","wooden_pickaxe","wooden_axe"].forEach(e=>{this.items.has(e)||this.items.set(e,{id:e,name:e.replace("_"," "),type:e.includes("axe")||e.includes("pickaxe")?"tool":"material",stackSize:e.includes("axe")||e.includes("pickaxe")?1:64,texture:`color:${e}`})})}try{const e=yield fetch("/data/recipes/recipe_catalog.json"),t=yield e.json();Object.values(t.recipe_catalog.crafting_recipes).forEach(e=>{Object.entries(e).forEach(([e,t])=>{this.recipes.set(e,a(l({},t),{id:e}))})})}catch(s){}this.initializeBiomes(),this.loaded=!0}catch(o){}})}initializeBiomes(){[{id:"plains",name:"Равнина",temperature:.8,humidity:.4,topBlock:"grass_block",fillBlock:"dirt",decorations:["tall_grass","flowers"],structures:["village"]},{id:"forest",name:"Лес",temperature:.7,humidity:.8,topBlock:"grass_block",fillBlock:"dirt",decorations:["oak_log","oak_leaves"],structures:["woodland_mansion"]},{id:"desert",name:"Пустыня",temperature:2,humidity:0,topBlock:"sand",fillBlock:"sand",decorations:["cactus","dead_bush"],structures:["desert_temple"]},{id:"ocean",name:"Океан",temperature:.5,humidity:.5,topBlock:"water",fillBlock:"water",decorations:["kelp","sea_grass"],structures:["ocean_ruin"]}].forEach(e=>this.biomes.set(e.id,e))}getBlock(e){return this.blocks.get(e)}getItem(e){return this.items.get(e)}getRecipe(e){return this.recipes.get(e)}getBiome(e){return this.biomes.get(e)}getAllBlocks(){return Array.from(this.blocks.values())}getAllItems(){return Array.from(this.items.values())}getAllRecipes(){return Array.from(this.recipes.values())}getAllBiomes(){return Array.from(this.biomes.values())}isLoaded(){return this.loaded||this.initialBlocksSet}};function w({position:e,blockType:t,onClick:s}){const o=u.useRef(null),[r,n]=u.useState(!1),i=j.getBlock(t);if(!i)return null;return m.jsx(p,{ref:o,position:e,args:[1,1,1],onClick:s,onPointerOver:()=>n(!0),onPointerOut:()=>n(!1),children:m.jsx("meshBasicMaterial",{color:r?"#ffff00":(l=t,{grass_block:"#4a9c4a",dirt:"#8b4513",stone:"#808080",sand:"#f4e4bc",water:"#1e90ff",wood_log:"#8B4513",oak_log:"#8B4513",oak_planks:"#deb887",cobblestone:"#696969",coal_ore:"#2f2f2f",iron_ore:"#cd853f",diamond_ore:"#87ceeb",glass:"#e0f6ff",leaves:"#228b22",oak_leaves:"#228b22"}[l]||"#ffffff"),transparent:i.transparent,opacity:i.transparent?.7:1})});var l}function N({chunk:e,onBlockClick:t}){var s;const o=[],r=j.getAllBlocks();for(let n=0;n<16;n++)for(let i=0;i<16;i++)for(let l=0;l<64;l++){const a=256*l+16*i+n,c=e.blocks[a];if(c>0&&c<=r.length){const a=(null==(s=r[c-1])?void 0:s.id)||"stone",d=16*e.x+n,u=16*e.z+i,h=63===l||0===e.blocks[256*(l+1)+16*i+n],x=0===n||15===n||0===i||15===i||0===e.blocks[256*l+16*i+(n-1)]||0===e.blocks[256*l+16*i+(n+1)]||0===e.blocks[256*l+16*(i-1)+n]||0===e.blocks[256*l+16*(i+1)+n];(h||x)&&o.push(m.jsx(w,{position:[d,l,u],blockType:a,onClick:()=>t(d,l,u)},`${d}-${l}-${u}`))}}return m.jsx(m.Fragment,{children:o})}function I({controls:e,playerPosition:t,onCameraChange:s}){const{camera:o}=f(),[r,n]=u.useState(0),[i,l]=u.useState(0);return h(()=>{o.position.set(t[0],t[1]+1.6,t[2]),o.rotation.set(r,i,0,"YXZ"),s([r,i])}),null}function S({playerState:e,controls:t,chunks:s,onPlayerUpdate:o,onBlockBreak:r,onBlockPlace:n,worldGenerator:i,className:l=""}){const[a,c]=u.useState([]),[d,f]=u.useState([0,0]),p=u.useCallback(()=>{const t=Math.floor(e.position[0]/16),o=Math.floor(e.position[2]/16),r=[];for(let e=-2;e<=2;e++)for(let n=-2;n<=2;n++){const l=t+e,a=o+n,c=i.getChunkKey(l,a);let d=s.get(c);d||(d=i.generateChunk(l,a),s.set(c,d)),r.push(d)}c(r)},[e.position,s,i]);u.useEffect(()=>{p()},[p]);h((s,r)=>{(s=>{if(!t.moveStick||0===t.moveStick.x&&0===t.moveStick.y)return;const r=(t.sprintPressed?8:4)*s,[n,i]=d,l=new v(Math.sin(i)*t.moveStick.y,0,Math.cos(i)*t.moveStick.y),a=new v(Math.cos(i)*t.moveStick.x,0,-Math.sin(i)*t.moveStick.x),c=l.add(a).multiplyScalar(r),u=[e.position[0]+c.x,e.position[1]+(t.jumpPressed?.1:t.crouchPressed?-.05:0),e.position[2]+c.z];o({position:u,rotation:d})})(r)});const y=(e,s,o)=>{t.actionPressed&&r(e,s,o)};return m.jsxs("div",{className:`w-full h-full ${l}`,children:[m.jsxs(x,{camera:{fov:75,near:.1,far:1e3,position:[e.position[0],e.position[1]+1.6,e.position[2]]},gl:{antialias:!1,powerPreference:"low-power",alpha:!1,depth:!0,stencil:!1,logarithmicDepthBuffer:!1},dpr:[1,1],frameloop:"demand",shadows:!1,children:[m.jsx(I,{controls:t,playerPosition:e.position,onCameraChange:f}),m.jsx("ambientLight",{intensity:.8})," ",m.jsx("directionalLight",{position:[50,100,50],intensity:.5,castShadow:!1}),a.map(e=>m.jsx(N,{chunk:e,onBlockClick:y},`chunk-${e.x}-${e.z}`)),m.jsx(b,{args:[500],position:[0,0,0],children:m.jsx("meshBasicMaterial",{color:"#87CEEB",side:g,fog:!1})})]}),m.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none",children:m.jsx("div",{className:"w-4 h-4 border-2 border-white rounded-full opacity-60"})})]})}function _({onControlsChange:e,className:t=""}){const[s,o]=u.useState({moveStick:{x:0,y:0},lookSensitivity:2,jumpPressed:!1,sprintPressed:!1,crouchPressed:!1,actionPressed:!1}),r=u.useRef(null),n=u.useRef(null),[i,c]=u.useState(!1),[d,h]=u.useState({x:0,y:0}),[x,b]=u.useState({x:0,y:0}),g=u.useCallback(t=>{o(s=>{const o=l(l({},s),t);return e(o),o})},[e]),f=u.useCallback(e=>{var t;e.preventDefault(),e.touches[0];const s=null==(t=r.current)?void 0:t.getBoundingClientRect();if(!s)return;const o=s.left+s.width/2,n=s.top+s.height/2;h({x:o,y:n}),c(!0)},[]),p=u.useCallback(e=>{if(!i||!r.current)return;e.preventDefault();const t=e.touches[0],s=r.current.getBoundingClientRect().width/2,o=t.clientX-d.x,n=t.clientY-d.y,l=Math.sqrt(o*o+n*n),a=Math.min(l,s),c=Math.atan2(n,o),u=a*Math.cos(c)/s,h=a*Math.sin(c)/s;g({moveStick:{x:u,y:-h}})},[i,d,g]),v=u.useCallback(()=>{c(!1),g({moveStick:{x:0,y:0}})},[g]),y=u.useCallback(e=>{const t=e.touches[0];b({x:t.clientX,y:t.clientY})},[]),k=u.useCallback(t=>{if(0===t.touches.length)return;const o=t.touches[0],r=o.clientX-x.x,n=o.clientY-x.y,i=.002*s.lookSensitivity,c=a(l({},s),{cameraRotation:{deltaX:r*i,deltaY:n*i}});e(c),b({x:o.clientX,y:o.clientY})},[x,s,e]);return u.useEffect(()=>{const e=e=>{i?p(e):k(e)},t=()=>{v()};return i?(document.addEventListener("touchmove",e,{passive:!1}),document.addEventListener("touchend",t)):document.addEventListener("touchmove",k,{passive:!0}),()=>{document.removeEventListener("touchmove",e),document.removeEventListener("touchmove",k),document.removeEventListener("touchend",t)}},[i,p,v,k]),m.jsxs("div",{className:`absolute inset-0 pointer-events-none ${t}`,children:[m.jsx("div",{ref:n,className:"absolute inset-0 pointer-events-auto",onTouchStart:y,style:{touchAction:"none"}}),m.jsxs("div",{className:"absolute bottom-20 left-6 pointer-events-auto",children:[m.jsx("div",{ref:r,className:"w-24 h-24 rounded-full border-4 border-gray-800 bg-gray-900/50 backdrop-blur-sm relative touch-none",onTouchStart:f,style:{touchAction:"none"},children:m.jsx("div",{className:"absolute w-8 h-8 rounded-full bg-white transform -translate-x-1/2 -translate-y-1/2",style:{left:"50%",top:"50%",transform:`translate(-50%, -50%) translate(${32*s.moveStick.x}px, ${32*s.moveStick.y}px)`}})}),m.jsx("div",{className:"text-center mt-2 text-white text-xs opacity-70",children:"Движение"})]}),m.jsxs("div",{className:"absolute bottom-20 right-6 flex flex-col gap-3 pointer-events-auto",children:[m.jsx("button",{className:"w-16 h-16 rounded-full border-4 border-gray-800 font-bold text-white transition-colors "+(s.jumpPressed?"bg-blue-500":"bg-gray-900/50 backdrop-blur-sm"),onTouchStart:()=>g({jumpPressed:!0}),onTouchEnd:()=>g({jumpPressed:!1}),style:{touchAction:"none"},children:"↑"}),m.jsx("button",{className:"w-16 h-16 rounded-full border-4 border-gray-800 font-bold text-white transition-colors "+(s.crouchPressed?"bg-yellow-500":"bg-gray-900/50 backdrop-blur-sm"),onTouchStart:()=>g({crouchPressed:!0}),onTouchEnd:()=>g({crouchPressed:!1}),style:{touchAction:"none"},children:"↓"})]}),m.jsxs("div",{className:"absolute bottom-32 right-24 pointer-events-auto",children:[m.jsx("button",{className:"w-20 h-20 rounded-full border-4 border-gray-800 font-bold text-white text-2xl transition-colors "+(s.actionPressed?"bg-red-500":"bg-gray-900/50 backdrop-blur-sm"),onTouchStart:()=>g({actionPressed:!0}),onTouchEnd:()=>g({actionPressed:!1}),style:{touchAction:"none"},children:"⚙️"}),m.jsx("div",{className:"text-center mt-1 text-white text-xs opacity-70",children:"Действие"})]}),m.jsx("div",{className:"absolute bottom-6 left-32 pointer-events-auto",children:m.jsx("button",{className:"px-4 py-2 rounded-lg border-2 border-gray-800 font-bold text-white text-sm transition-colors "+(s.sprintPressed?"bg-green-500":"bg-gray-900/50 backdrop-blur-sm"),onTouchStart:()=>g({sprintPressed:!0}),onTouchEnd:()=>g({sprintPressed:!1}),style:{touchAction:"none"},children:"Бег"})})]})}function B({player:e,hotbar:t,selectedSlot:s,onSlotSelect:o,onInventoryOpen:r,currentTime:n,className:i=""}){const l=(e,t)=>{const s=2*(e+1);return t>=s?"❤️":t>=s-1?"🧡":"💔"},a=(e,t)=>{const s=2*(e+1);return t>=s?"🍖":t>=s-1?"🍞":"🕳️"},c=e=>{if(!e.itemId)return null;if(!(j.getItem(e.itemId)||j.getBlock(e.itemId)))return"?";return{dirt:"🟧",stone:"⚫",grass_block:"🌿",wood_log:"🪵",oak_log:"🪵",sand:"🟡",cobblestone:"⚫",oak_planks:"🟦",glass:"🔺",coal_ore:"⚫",iron_ore:"🔘",diamond_ore:"💎",crafting_table:"🪵",furnace:"🔥",chest:"📦",torch:"🕯️",water:"🌊",wooden_pickaxe:"⛏️",stone_pickaxe:"⛏️",iron_pickaxe:"⛏️",wooden_axe:"🪓",wooden_shovel:"🥄",wooden_sword:"⚔️",stick:"🌳",coal:"⚫",iron_ingot:"💰",diamond:"💎"}[e.itemId]||"📎"};return m.jsxs("div",{className:`absolute inset-0 pointer-events-none ${i}`,children:[m.jsx("div",{className:"absolute top-safe left-0 right-0 p-4 bg-black/30 backdrop-blur-sm",children:m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsxs("div",{className:"flex flex-col gap-1",children:[m.jsx("div",{className:"flex gap-1",children:Array.from({length:10},(t,s)=>m.jsx("span",{className:"text-lg",children:l(s,e.health)},s))}),m.jsx("div",{className:"flex gap-1",children:Array.from({length:10},(t,s)=>m.jsx("span",{className:"text-lg",children:a(s,e.hunger)},s))})]}),m.jsxs("div",{className:"text-right text-white",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[m.jsx("span",{className:"text-2xl",children:(e=>{const t=(Math.floor(e/1e3)+6)%24;return t>=6&&t<18?"☀️":"🌙"})(n)}),m.jsx("span",{className:"font-mono text-lg",children:(e=>{const t=Math.floor(e/1e3)+6,s=Math.floor(e%1e3/1e3*60);return`${(t%24).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`})(n)})]}),m.jsxs("div",{className:"text-sm opacity-75",children:["XP: ",e.experience]})]})]})}),m.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 pointer-events-auto",children:m.jsx("div",{className:"flex gap-1 bg-black/60 backdrop-blur-sm p-2 rounded-lg",children:t.map((e,t)=>m.jsx("button",{className:"w-12 h-12 border-2 rounded-lg flex flex-col items-center justify-center relative transition-all "+(s===t?"border-white bg-white/20 scale-110":"border-gray-600 bg-gray-900/50 hover:border-gray-400"),onClick:()=>o(t),children:e.itemId&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"text-lg",children:c(e)}),e.count>1&&m.jsx("div",{className:"absolute bottom-0 right-0 text-xs text-white bg-gray-800 rounded-full w-4 h-4 flex items-center justify-center",children:e.count>99?"99+":e.count}),void 0!==e.durability&&e.durability<100&&m.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-red-500 rounded-b",style:{width:`${e.durability}%`}})]})},t))})}),m.jsx("div",{className:"absolute top-safe right-4 pointer-events-auto",children:m.jsx("button",{onClick:r,className:"w-12 h-12 rounded-lg bg-gray-900/60 backdrop-blur-sm border-2 border-gray-600 text-white text-xl hover:border-gray-400 transition-colors",children:"🎒"})}),m.jsx("div",{className:"absolute top-20 right-4 w-20 h-20 bg-black/60 backdrop-blur-sm rounded-lg border-2 border-gray-600 pointer-events-auto",children:m.jsx("div",{className:"w-full h-full flex items-center justify-center text-white text-xs",children:m.jsxs("div",{className:"text-center",children:[m.jsxs("div",{children:["X: ",Math.floor(e.position[0])]}),m.jsxs("div",{children:["Y: ",Math.floor(e.position[1])]}),m.jsxs("div",{children:["Z: ",Math.floor(e.position[2])]})]})})})]})}function C({isOpen:e,inventory:t,hotbar:s,onInventoryChange:o,onHotbarChange:r,onClose:n}){const[i,c]=u.useState("inventory"),[d,h]=u.useState(null),[x,b]=u.useState(Array(9).fill({itemId:null,count:0})),[g,f]=u.useState(null);if(!e)return null;const p=e=>{if(!e.itemId)return null;if(!(j.getItem(e.itemId)||j.getBlock(e.itemId)))return"?";return{dirt:"🟧",stone:"⚫",grass_block:"🌿",wood_log:"🪵",oak_log:"🪵",sand:"🟡",cobblestone:"⚫",oak_planks:"🟦",glass:"🔺",coal_ore:"⚫",iron_ore:"🔘",diamond_ore:"💎",crafting_table:"🪵",furnace:"🔥",chest:"📦",torch:"🕯️",water:"🌊",wooden_pickaxe:"⛏️",stone_pickaxe:"⛏️",iron_pickaxe:"⛏️",wooden_axe:"🪓",wooden_shovel:"🥄",wooden_sword:"⚔️",stick:"🌳",coal:"⚫",iron_ingot:"💰",diamond:"💎"}[e.itemId]||"📎"},v=(e,n)=>{const i="hotbar"===e.type?s:t,a="hotbar"===n.type?s:t,c=l({},i[e.index]),d=l({},a[n.index]),u=[...i],h=[...a];u[e.index]=d,h[n.index]=c,"hotbar"===e.type?r(u):o(u),"hotbar"===n.type&&"hotbar"!==e.type?r(h):"inventory"===n.type&&"inventory"!==e.type&&o(h)},y=()=>{const e=j.getAllRecipes();return x[0].itemId,x[1].itemId,x[3].itemId,x[4].itemId,e.find(e=>{if("shapeless"===e.type){const t=e.ingredients||[],s=x.filter(e=>e.itemId).map(e=>e.itemId);return t.length===s.length&&t.every(e=>s.includes(e))}return!1})||null},k=(e,t,s)=>{const o=(null==d?void 0:d.type)===t&&(null==d?void 0:d.index)===s;return m.jsx("button",{className:"w-12 h-12 border-2 rounded-lg flex flex-col items-center justify-center relative transition-all "+(o?"border-yellow-400 bg-yellow-400/20 scale-105":"border-gray-600 bg-gray-800/50 hover:border-gray-400"),onClick:()=>((e,t,s)=>{e.itemId&&(d&&"crafting"!==d.type&&"crafting"!==t?(v(d,{type:t,index:s}),h(null)):h({type:t,index:s}))})(e,t,s),children:e.itemId&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"text-lg",children:p(e)}),e.count>1&&m.jsx("div",{className:"absolute bottom-0 right-0 text-xs text-white bg-gray-900 rounded-full w-4 h-4 flex items-center justify-center",children:e.count>99?"99+":e.count}),void 0!==e.durability&&e.durability<100&&m.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-red-500 rounded-b",style:{width:`${e.durability}%`}})]})},`${t}-${s}`)};return m.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:m.jsxs("div",{className:"bg-gray-900 rounded-xl border-2 border-gray-700 w-full max-w-md max-h-[90vh] overflow-hidden",children:[m.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-700",children:[m.jsx("h2",{className:"text-xl font-bold text-white",children:"Инвентарь"}),m.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white text-2xl p-1",children:"×"})]}),m.jsxs("div",{className:"flex border-b border-gray-700",children:[m.jsx("button",{className:"flex-1 py-3 px-4 text-sm font-medium "+("inventory"===i?"text-white bg-gray-800":"text-gray-400 hover:text-white"),onClick:()=>c("inventory"),children:"🎒 Предметы"}),m.jsx("button",{className:"flex-1 py-3 px-4 text-sm font-medium "+("crafting"===i?"text-white bg-gray-800":"text-gray-400 hover:text-white"),onClick:()=>c("crafting"),children:"⚙️ Крафт"})]}),m.jsxs("div",{className:"overflow-y-auto",style:{maxHeight:"calc(90vh - 140px)"},children:["inventory"===i&&m.jsxs("div",{className:"p-4 space-y-4",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"text-white text-sm font-medium mb-2",children:"Панель быстрого доступа:"}),m.jsx("div",{className:"grid grid-cols-9 gap-1",children:s.map((e,t)=>k(e,"hotbar",t))})]}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-white text-sm font-medium mb-2",children:"Основной инвентарь:"}),m.jsx("div",{className:"grid grid-cols-9 gap-1",children:t.map((e,t)=>k(e,"inventory",t))})]})]}),"crafting"===i&&m.jsxs("div",{className:"p-4 space-y-4",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"text-white text-sm font-medium mb-2",children:"Крафтинг (2x2):"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"grid grid-cols-3 gap-1 p-3 bg-gray-800 rounded-lg",children:x.slice(0,9).map((e,n)=>m.jsx("button",{className:"w-12 h-12 border-2 rounded-lg flex items-center justify-center relative "+(n<2||n>=3&&n<5?"border-gray-500 bg-gray-700":"border-gray-700 bg-gray-800"),onClick:()=>{if(d&&"crafting"!==d.type){const e="hotbar"===d.type?s:t,i=e[d.index];if(i.itemId){const t=[...x];t[n]={itemId:i.itemId,count:1},b(t);const s=[...e];s[d.index].count>1?s[d.index].count--:s[d.index]={itemId:null,count:0},"hotbar"===d.type?r(s):o(s),h(null)}}},disabled:!(n<2||n>=3&&n<5),children:e.itemId&&(n<2||n>=3&&n<5)&&m.jsx("div",{className:"text-lg",children:p(e)})},n))}),m.jsx("div",{className:"text-white text-2xl",children:"→"}),m.jsx("div",{className:"w-12 h-12 border-2 border-green-500 bg-green-500/20 rounded-lg flex items-center justify-center",children:(()=>{const e=y();return e?p({itemId:e.result.item,count:e.result.count}):null})()})]}),m.jsx("button",{onClick:()=>{const e=y();if(!e)return;const s=x.map(e=>e.itemId&&e.count>1?a(l({},e),{count:e.count-1}):{itemId:null,count:0});b(s);const r=[...t],n=e.result,i=r.findIndex(e=>!e.itemId||e.itemId===n.item&&e.count+n.count<=64);-1!==i&&(r[i].itemId?r[i].count+=n.count:r[i]={itemId:n.item,count:n.count},o(r))},disabled:!y(),className:"w-full py-2 px-4 rounded-lg font-medium transition-colors "+(y()?"bg-green-600 hover:bg-green-500 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"),children:y()?"Скрафтить":"Нет рецепта"})]}),m.jsxs("div",{children:[m.jsx("h3",{className:"text-white text-sm font-medium mb-2",children:"Популярные рецепты:"}),m.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[m.jsxs("div",{className:"bg-gray-800 p-2 rounded",children:[m.jsx("div",{className:"text-white font-medium",children:"Доски"}),m.jsx("div",{className:"text-gray-400",children:"1x Бревно → 4x Доски"})]}),m.jsxs("div",{className:"bg-gray-800 p-2 rounded",children:[m.jsx("div",{className:"text-white font-medium",children:"Палки"}),m.jsx("div",{className:"text-gray-400",children:"2x Доски → 4x Палки"})]}),m.jsxs("div",{className:"bg-gray-800 p-2 rounded",children:[m.jsx("div",{className:"text-white font-medium",children:"Верстак"}),m.jsx("div",{className:"text-gray-400",children:"4x Доски → Верстак"})]}),m.jsxs("div",{className:"bg-gray-800 p-2 rounded",children:[m.jsx("div",{className:"text-white font-medium",children:"Факел"}),m.jsx("div",{className:"text-gray-400",children:"1x Уголь + 1x Палка"})]})]})]})]})]})]})})}class M{constructor(e){c(this,"seed"),this.seed=e}noise2D(e,t){return(Math.sin(.1*e+this.seed)*Math.cos(.1*t+this.seed)+1)/2}octaveNoise2D(e,t,s=4){let o=0,r=1,n=.01,i=0;for(let l=0;l<s;l++)o+=this.noise2D(e*n,t*n)*r,i+=r,r*=.5,n*=2;return o/i}}class E{constructor(e){c(this,"noise"),c(this,"blockIds",new Map),c(this,"biomesArray",[]);const t=this.stringToSeed(e);this.noise=new M(t),this.initializeBlockIds()}stringToSeed(e){let t=0;for(let s=0;s<e.length;s++){t=(t<<5)-t+e.charCodeAt(s),t&=t}return Math.abs(t)}initializeBlockIds(){j.getAllBlocks().forEach((e,t)=>{this.blockIds.set(e.id,t+1)}),this.biomesArray=j.getAllBiomes()}generateChunk(e,t){const s=new Uint16Array(16384);for(let o=0;o<16;o++)for(let r=0;r<16;r++){const n=16*e+o,i=16*t+r,l=this.getBiome(n,i),a=Math.floor(32*this.noise.octaveNoise2D(n,i,4)+16);for(let e=0;e<64;e++){const t=this.getBlockIndex(o,e,r);0===e?s[t]=this.getBlockId("bedrock")||this.getBlockId("stone")||1:e<a-3?s[t]=this.getBlockId("stone")||1:e<a-1?s[t]=this.getBlockId(l.fillBlock)||this.getBlockId("dirt")||1:e===a-1?s[t]=this.getBlockId(l.topBlock)||this.getBlockId("grass_block")||1:e<32&&(s[t]=this.getBlockId("water")||0)}this.generateOres(s,o,r,a),"forest"===l.id&&Math.random()<.1&&this.generateTree(s,o,a,r)}return{x:e,z:t,blocks:s,generated:!0}}getBiome(e,t){if(0===this.biomesArray.length)return{id:"plains",name:"Равнина",temperature:.8,humidity:.4,topBlock:"grass_block",fillBlock:"dirt",decorations:[],structures:[]};const s=this.noise.noise2D(.001*e,.001*t),o=Math.floor(s*this.biomesArray.length);return this.biomesArray[o]||this.biomesArray[0]}generateOres(e,t,s,o){if(Math.random()<.05&&o>10){const r=Math.floor(Math.random()*(o-5))+1;e[this.getBlockIndex(t,r,s)]=this.getBlockId("coal_ore")||this.getBlockId("stone")||1}if(Math.random()<.02&&o>15){const r=Math.floor(Math.random()*(o-10))+1;e[this.getBlockIndex(t,r,s)]=this.getBlockId("iron_ore")||this.getBlockId("stone")||1}}generateTree(e,t,s,o){const r=4+Math.floor(3*Math.random()),n=this.getBlockId("oak_log")||this.getBlockId("wood_log")||1,i=this.getBlockId("oak_leaves")||n;for(let a=s;a<s+r&&a<63;a++){e[this.getBlockIndex(t,a,o)]=n}const l=s+r-1;for(let a=-2;a<=2;a++)for(let s=-2;s<=2;s++)if(t+a>=0&&t+a<16&&o+s>=0&&o+s<16&&Math.abs(a)+Math.abs(s)<3&&l<63){e[this.getBlockIndex(t+a,l,o+s)]=i}}getBlockIndex(e,t,s){return 256*t+16*s+e}getBlockId(e){return this.blockIds.get(e)||this.blockIds.get(e.replace("_",""))}getChunkKey(e,t){return`${e},${t}`}}function P(){const[e,t]=u.useState(null),[s,o]=u.useState({moveStick:{x:0,y:0},lookSensitivity:2,jumpPressed:!1,sprintPressed:!1,crouchPressed:!1,actionPressed:!1}),[r,n]=u.useState(null),[i,c]=u.useState(!1),[h,x]=u.useState(!0),[b,g]=u.useState(null),[f,p]=u.useState(0);u.useEffect(()=>{(()=>{d(this,null,function*(){try{x(!0),yield j.loadGameData();const s=new E("minecraft-mobile-"+Date.now());n(s);const o={player:{position:[0,65,0],rotation:[0,0],health:20,hunger:20,experience:0,gameMode:"survival"},inventory:Array(27).fill(0).map((e,t)=>t<5?{itemId:["coal","iron_ore","cobblestone","oak_planks","stick"][t],count:32}:{itemId:null,count:0}),hotbar:[{itemId:"dirt",count:64},{itemId:"stone",count:64},{itemId:"wood_log",count:64},{itemId:"wooden_pickaxe",count:1,durability:100},{itemId:"wooden_axe",count:1,durability:100},{itemId:null,count:0},{itemId:null,count:0},{itemId:null,count:0},{itemId:null,count:0}],selectedSlot:0,chunks:new Map,time:6e3,weather:"clear"};t(o);const r=localStorage.getItem("minecraft-mobile-save");if(r)try{const e=JSON.parse(r);e.player&&e.inventory&&t(t=>l(l({},t),e))}catch(e){}x(!1)}catch(s){g("Ошибка загрузки игры. Попробуйте обновить страницу."),x(!1)}})})()},[]),u.useEffect(()=>{if(!e)return;const t=setInterval(()=>{try{const t={player:e.player,inventory:e.inventory,hotbar:e.hotbar,selectedSlot:e.selectedSlot,time:e.time};localStorage.setItem("minecraft-mobile-save",JSON.stringify(t))}catch(t){}},3e4);return()=>clearInterval(t)},[e]),u.useEffect(()=>{const e=setInterval(()=>{t(e=>{if(!e)return e;const t=(e.time+20)%24e3;return a(l({},e),{time:t})}),p(e=>e+20)},50);return()=>clearInterval(e)},[]);const v=u.useCallback(e=>{t(t=>t?a(l({},t),{player:l(l({},t.player),e)}):t)},[]),y=u.useCallback((t,s,o)=>{if(!e||!r)return;const n=Math.floor(t/16),i=Math.floor(o/16),l=r.getChunkKey(n,i),a=e.chunks.get(l);if(a){const e=256*s+16*(o-16*i)+(t-16*n);a.blocks[e]>0&&(a.blocks[e]=0)}},[e,r]),k=u.useCallback((t,s,o)=>{if(!e||!r)return;const n=e.hotbar[e.selectedSlot];if(!n.itemId||n.count<=0)return;j.getBlock(n.itemId)},[e,r]),w=u.useCallback(e=>{t(t=>t?a(l({},t),{selectedSlot:e}):t)},[]),N=u.useCallback(e=>{t(t=>t?a(l({},t),{inventory:e}):t)},[]),I=u.useCallback(e=>{t(t=>t?a(l({},t),{hotbar:e}):t)},[]);return u.useEffect(()=>{const e=e=>{var t;e.touches.length>1||(null==(t=e.target)?void 0:t.closest(".scrollable"))||e.preventDefault()};return document.addEventListener("touchstart",e,{passive:!1}),document.addEventListener("touchmove",e,{passive:!1}),()=>{document.removeEventListener("touchstart",e),document.removeEventListener("touchmove",e)}},[]),h?m.jsx("div",{className:"w-full h-screen bg-gradient-to-b from-blue-400 to-green-400 flex items-center justify-center",children:m.jsxs("div",{className:"text-center text-white",children:[m.jsx("div",{className:"text-4xl font-bold mb-4",children:"🎮 Minecraft Mobile"}),m.jsx("div",{className:"text-xl mb-8",children:"Загрузка игры..."}),m.jsx("div",{className:"w-64 h-2 bg-gray-700 rounded-full mx-auto",children:m.jsx("div",{className:"h-full bg-green-500 rounded-full animate-pulse",style:{width:"70%"}})})]})}):!b&&e&&r?m.jsxs("div",{className:"w-full h-screen bg-black overflow-hidden relative",children:[m.jsx(S,{playerState:e.player,controls:s,chunks:e.chunks,onPlayerUpdate:v,onBlockBreak:y,onBlockPlace:k,worldGenerator:r,className:"absolute inset-0"}),m.jsx(B,{player:e.player,hotbar:e.hotbar,selectedSlot:e.selectedSlot,currentTime:e.time,onSlotSelect:w,onInventoryOpen:()=>c(!0)}),m.jsx(_,{onControlsChange:o,className:"absolute inset-0"}),m.jsx(C,{isOpen:i,inventory:e.inventory,hotbar:e.hotbar,onInventoryChange:N,onHotbarChange:I,onClose:()=>c(!1)}),m.jsx("button",{onClick:()=>{document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen()},className:"absolute top-4 left-4 w-10 h-10 bg-black/50 backdrop-blur-sm rounded-lg border border-gray-600 text-white hover:bg-black/70 transition-colors z-40",title:"Полный экран",children:"⛶"}),!1]}):m.jsx("div",{className:"w-full h-screen bg-red-900 flex items-center justify-center",children:m.jsxs("div",{className:"text-center text-white p-8",children:[m.jsx("div",{className:"text-2xl font-bold mb-4",children:"❌ Ошибка"}),m.jsx("div",{className:"text-lg mb-4",children:b||"Неизвестная ошибка"}),m.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 hover:bg-red-500 px-6 py-3 rounded-lg font-medium",children:"Перезагрузить"})]})})}function A(){const[e,t]=u.useState(!0),[s,o]=u.useState(null);u.useEffect(()=>{const e=document.createElement("canvas");if(!(e.getContext("webgl")||e.getContext("experimental-webgl")))return void t(!1);const s=e=>{e.preventDefault(),o(e)};window.addEventListener("beforeinstallprompt",s);const r=document.querySelector('meta[name="viewport"]');return r&&r.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"),()=>{window.removeEventListener("beforeinstallprompt",s)}},[]);return e?m.jsxs("div",{className:"app-container",children:[s&&m.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50",children:m.jsxs("div",{className:"bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3",children:[m.jsx("span",{className:"text-sm font-medium",children:"Установить приложение?"}),m.jsx("button",{onClick:()=>d(this,null,function*(){if(!s)return;s.prompt();"accepted"===(yield s.userChoice).outcome&&o(null)}),className:"bg-white text-green-600 px-3 py-1 rounded text-sm font-medium hover:bg-gray-100",children:"Да"}),m.jsx("button",{onClick:()=>o(null),className:"text-green-200 hover:text-white text-sm",children:"Нет"})]})}),m.jsx(P,{})]}):m.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-900 to-red-700 flex items-center justify-center p-4",children:m.jsxs("div",{className:"bg-white rounded-xl p-8 max-w-md text-center shadow-2xl",children:[m.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),m.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Неподдерживаемое устройство"}),m.jsx("p",{className:"text-gray-600 mb-6",children:"Ваш браузер не поддерживает WebGL, который необходим для работы игры."}),m.jsx("p",{className:"text-sm text-gray-500",children:"Попробуйте открыть сайт в Chrome, Safari или Firefox."})]})})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{}).catch(e=>{})}),document.addEventListener("contextmenu",e=>{e.preventDefault()}),window.addEventListener("error",e=>{}),window.addEventListener("unhandledrejection",e=>{}),y.createRoot(document.getElementById("root")).render(m.jsx(k.StrictMode,{children:m.jsx(A,{})}));
